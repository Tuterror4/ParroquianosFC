<!DOCTYPE html>
<html>
<head>
    <title>Parroquianos FC - Elecci칩n de N칰mero y Talla</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* Dise침o Simple */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            max-width: 450px; 
            margin: 40px auto; 
            padding: 30px; 
            background-color: #f4f4f9;
            border: 1px solid #ddd; 
            border-radius: 10px; 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        h2 {
            text-align: center;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 25px;
        }
        label {
            display: block;
            margin-top: 15px;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        input[type="text"], select { 
            width: 100%; 
            padding: 12px; 
            margin-bottom: 15px; 
            box-sizing: border-box; 
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }
        button { 
            background-color: #3498db; 
            color: white; 
            padding: 15px 20px; 
            margin-top: 10px; 
            border: none; 
            cursor: pointer; 
            width: 100%; 
            border-radius: 5px;
            font-size: 18px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        #mensaje { 
            margin-top: 25px; 
            padding: 15px; 
            border-radius: 5px; 
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <h2>Parroquianos FC</h2>
    <form id="registroForm">
        <label for="nombre">Nombre dorsal:</label>
        <input type="text" id="nombre" name="nombre" required>
        
        <label for="talla">Talla:</label>
        <select id="talla" name="talla" required>
            <option value="" disabled selected>Cargando tallas...</option>
        </select>
        
        <label for="numero">N칰mero para la camiseta:</label>
        <select id="numero" name="numero" required>
            <option value="" disabled selected>Cargando n칰meros...</option>
        </select>

        <button type="submit" id="submitBtn" disabled>Elegir y Confirmar</button>
    </form>

    <div id="mensaje"></div>

    <script>
        // 游뚿 춰Importante! Pega tu URL de Apps Script aqu칤 游뚿
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwCyujiNMimjOSSDD4CHdgF5vF6OcioyCX898ww3S6q3yayTy5B7O1dXaZnD-q0dou5/exec'; 

        const MAX_NUMERO = 19; 
        const MIN_NUMERO = 1;
        // Talllas y sus etiquetas de precio
        const TALLAS_CON_PRECIO = {
            'S': '(25)',
            'M': '(25)',
            'L': '(25)',
            'XL': '(27)'
        };

        // Funci칩n para cargar la lista de n칰meros ocupados
        async function cargarDatosDisponibles() {
            const numeroSelect = document.getElementById('numero');
            const tallaSelect = document.getElementById('talla');
            const submitBtn = document.getElementById('submitBtn');
            
            // Mensajes de carga inicial
            numeroSelect.innerHTML = '<option value="" disabled selected>Cargando...</option>';
            tallaSelect.innerHTML = '<option value="" disabled selected>Cargando...</option>';
            submitBtn.disabled = true;

            try {
                // Consulta al Apps Script (usando doGet) para obtener los n칰meros ocupados
                const response = await fetch(APPS_SCRIPT_URL + '?action=get_data');
                // El servidor ahora devuelve directamente el array de n칰meros ocupados
                const numerosOcupados = await response.json(); 
                
                // --- 1. Generar Opciones de N칔MERO ---
                numeroSelect.innerHTML = '<option value="" disabled selected>Selecciona un n칰mero</option>';
                let numerosRestantes = 0;
                
                for (let i = MIN_NUMERO; i <= MAX_NUMERO; i++) {
                    const numString = String(i);
                    const option = document.createElement('option');
                    option.value = numString;
                    option.textContent = numString;
                    
                    if (numerosOcupados.includes(numString)) {
                        option.disabled = true;
                        option.textContent += ' (OCUPADO)';
                    } else {
                        numerosRestantes++;
                    }
                    numeroSelect.appendChild(option);
                }

                // --- 2. Generar Opciones de TALLA ---
                tallaSelect.innerHTML = '<option value="" disabled selected>Selecciona una talla</option>';
                let tallasDisponibles = 0; // Solo para habilitar el bot칩n

                for (const talla in TALLAS_CON_PRECIO) {
                    const option = document.createElement('option');
                    option.value = talla;
                    option.textContent = `${talla} ${TALLAS_CON_PRECIO[talla]}`; // Muestra la talla y la etiqueta de precio
                    tallaSelect.appendChild(option);
                    tallasDisponibles++;
                }

                // Habilitar el bot칩n de env칤o si hay opciones disponibles
                submitBtn.disabled = (numerosRestantes === 0 || tallasDisponibles === 0);
                
            } catch (error) {
                console.error('Error al cargar datos:', error);
                numeroSelect.innerHTML = '<option value="" disabled selected>Error de conexi칩n</option>';
                tallaSelect.innerHTML = '<option value="" disabled selected>Error de conexi칩n</option>';
            }
        }

        // Funci칩n para enviar el formulario
        document.getElementById('registroForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const form = e.target;
            const mensajeDiv = document.getElementById('mensaje');
            mensajeDiv.textContent = 'Procesando tu elecci칩n...';
            mensajeDiv.style.backgroundColor = '#ffffcc';

            const formData = new FormData(form);
            const data = new URLSearchParams();
            
            data.append('nombre', formData.get('nombre'));
            data.append('numero', formData.get('numero'));
            data.append('talla', formData.get('talla')); 
            data.append('action', 'save_number'); 

            fetch(APPS_SCRIPT_URL, {
                method: 'POST',
                body: data
            })
            .then(response => response.text())
            .then(result => {
                mensajeDiv.textContent = result;
                if (result.includes("춰Felicidades!")) {
                    mensajeDiv.style.backgroundColor = '#d4edda'; 
                    form.reset(); 
                    cargarDatosDisponibles(); // Recargar la lista de n칰meros ocupados
                } else if (result.includes("ya ha sido elegido")) {
                    mensajeDiv.style.backgroundColor = '#f8d7da'; 
                } else {
                     mensajeDiv.style.backgroundColor = '#f8d7da'; 
                }
            })
            .catch(error => {
                console.error('Error:', error);
                mensajeDiv.textContent = 'Ocurri칩 un error de conexi칩n.';
                mensajeDiv.style.backgroundColor = '#f8d7da';
            });
        });

        // Carga inicial de datos al abrir la p치gina
        cargarDatosDisponibles();

    </script>
</body>
</html>
