<!DOCTYPE html>
<html>
<head>
    <title>Parroquianos FC - Elecci칩n de N칰mero</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* Dise침o Simple */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            max-width: 450px; 
            margin: 40px auto; 
            padding: 30px; 
            background-color: #f4f4f9;
            border: 1px solid #ddd; 
            border-radius: 10px; 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        h2 {
            text-align: center;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 25px;
        }
        label {
            display: block;
            margin-top: 15px;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        input[type="text"], select { 
            width: 100%; 
            padding: 12px; 
            margin-bottom: 15px; 
            box-sizing: border-box; 
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }
        button { 
            background-color: #3498db; 
            color: white; 
            padding: 15px 20px; 
            margin-top: 10px; 
            border: none; 
            cursor: pointer; 
            width: 100%; 
            border-radius: 5px;
            font-size: 18px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        #mensaje { 
            margin-top: 25px; 
            padding: 15px; 
            border-radius: 5px; 
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <h2>Parroquianos FC</h2>
    <form id="registroForm">
        <label for="nombre">Nombre dorsal:</label>
        <input type="text" id="nombre" name="nombre" required>

        <label for="numero">N칰mero de Camiseta Deseado:</label>
        <select id="numero" name="numero" required>
            <option value="" disabled selected>Cargando n칰meros...</option>
        </select>

        <button type="submit" id="submitBtn" disabled>Elegir y Confirmar</button>
    </form>

    <div id="mensaje"></div>

    <script>
        // 游뚿 춰Importante! Pega tu URL de Apps Script aqu칤 游뚿
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwCyujiNMimjOSSDD4CHdgF5vF6OcioyCX898ww3S6q3yayTy5B7O1dXaZnD-q0dou5/exec'; 

        const MAX_NUMERO = 19; // Define el n칰mero m치ximo disponible
        const MIN_NUMERO = 1;

        // Funci칩n para cargar la lista de n칰meros ocupados
        async function cargarNumerosDisponibles() {
            const numeroSelect = document.getElementById('numero');
            const submitBtn = document.getElementById('submitBtn');
            numeroSelect.innerHTML = '<option value="" disabled selected>Cargando n칰meros...</option>';
            submitBtn.disabled = true;

            try {
                // Consulta al Apps Script (usando doGet) para obtener los n칰meros ocupados
                const response = await fetch(APPS_SCRIPT_URL + '?action=get_numbers');
                const text = await response.text();
                
                // Intentar parsear la respuesta como JSON
                let numerosOcupados = [];
                try {
                    // Esperamos que el script devuelva un array JSON de n칰meros ocupados
                    numerosOcupados = JSON.parse(text); 
                } catch (e) {
                    console.error("No se pudo parsear la respuesta del servidor:", text);
                    // Si falla el JSON, asumimos que no hay n칰meros ocupados o hay un error, dejamos la lista vac칤a.
                }

                // Generar las opciones de la lista desplegable
                numeroSelect.innerHTML = '<option value="" disabled selected>Selecciona un n칰mero</option>';
                let numerosRestantes = 0;
                
                for (let i = MIN_NUMERO; i <= MAX_NUMERO; i++) {
                    const numString = String(i);
                    const option = document.createElement('option');
                    option.value = numString;
                    option.textContent = numString;
                    
                    if (numerosOcupados.includes(numString)) {
                        option.disabled = true;
                        option.textContent += ' (OCUPADO)';
                    } else {
                        numerosRestantes++;
                    }
                    numeroSelect.appendChild(option);
                }

                submitBtn.disabled = (numerosRestantes === 0);
                if (numerosRestantes === 0) {
                     numeroSelect.innerHTML = '<option value="" disabled selected>No quedan n칰meros disponibles</option>';
                }
                
            } catch (error) {
                console.error('Error al cargar n칰meros:', error);
                numeroSelect.innerHTML = '<option value="" disabled selected>Error al cargar la lista. Intenta de nuevo.</option>';
            }
        }

        // Funci칩n para enviar el formulario
        document.getElementById('registroForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const form = e.target;
            const mensajeDiv = document.getElementById('mensaje');
            mensajeDiv.textContent = 'Procesando tu elecci칩n...';
            mensajeDiv.style.backgroundColor = '#ffffcc';

            const formData = new FormData(form);
            const data = new URLSearchParams();
            
            // Aseg칰rate de que los nombres de los campos coincidan con el Apps Script (nombre, numero)
            data.append('nombre', formData.get('nombre'));
            data.append('numero', formData.get('numero'));
            data.append('action', 'save_number'); // Indicador para el Apps Script

            fetch(APPS_SCRIPT_URL, {
                method: 'POST',
                body: data
            })
            .then(response => response.text())
            .then(result => {
                mensajeDiv.textContent = result;
                if (result.includes("춰Felicidades!")) {
                    mensajeDiv.style.backgroundColor = '#d4edda'; // Verde
                    form.reset(); 
                    cargarNumerosDisponibles(); // Recargar la lista para mostrar el n칰mero como ocupado
                } else if (result.includes("ya ha sido elegido")) {
                    mensajeDiv.style.backgroundColor = '#f8d7da'; // Rojo
                } else {
                     mensajeDiv.style.backgroundColor = '#f8d7da'; 
                }
            })
            .catch(error => {
                console.error('Error:', error);
                mensajeDiv.textContent = 'Ocurri칩 un error de conexi칩n.';
                mensajeDiv.style.backgroundColor = '#f8d7da';
            });
        });

        // Carga inicial de n칰meros al abrir la p치gina
        cargarNumerosDisponibles();

    </script>
</body>
</html>